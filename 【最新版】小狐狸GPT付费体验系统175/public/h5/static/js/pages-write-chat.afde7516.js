(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-write-chat"],{"056a":function(t,e,a){var i=a("54fd");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("885c2bbe",i,!0,{sourceMap:!1,shadowMode:!1})},"1e4d":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticStyle:{height:"100%"}},[t.pageIsLoad?a("v-uni-view",{staticClass:"page"},[t.lists&&t.lists.length>0?a("v-uni-scroll-view",{staticClass:"box-msg-list",style:"bottom: "+(t.inputShow?"316rpx":"102rpx")+";",attrs:{"scroll-x":!1,"scroll-y":!0,"scroll-with-animation":!1,"scroll-top":t.scrollTop}},[a("v-uni-view",{staticClass:"list"},[t._l(t.lists,(function(e,i){return["AI"==e.user?a("v-uni-view",{key:i+"_0",staticClass:"message",staticStyle:{background:"#f7f7f8"},attrs:{"data-index":i}},[a("v-uni-view",{staticClass:"avatar"},[a("img",{attrs:{mode:"widthFix",src:"/static/img/ic_ai.png"}})]),a("v-uni-view",{staticClass:"text markdown-body"},[a("textComponent",{attrs:{text:e.message}}),a("v-uni-view",{staticStyle:{display:"block"}},[a("span",{staticClass:"btn-copy",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.copyText(e.message)}}},[t._v("复制内容")])])],1)],1):a("v-uni-view",{staticClass:"message",staticStyle:{background:"#fff"},attrs:{"data-index":i},on:{longpress:function(a){arguments[0]=a=t.$handleEvent(a),t.copyText(e.message)}}},[a("v-uni-view",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[a("img",{attrs:{mode:"widthFix",src:"/static/img/ic_user.png"}})]),a("v-uni-view",{staticClass:"text markdown-body"},[a("textComponent",{attrs:{text:e.message}})],1)],1)]})),t.writing||t.writingText?a("v-uni-view",{staticClass:"message",staticStyle:{background:"#f7f7f8"}},[a("v-uni-view",{staticClass:"avatar"},[a("img",{attrs:{src:"/static/img/ic_ai.png"}})]),a("v-uni-view",{staticClass:"text markdown-body"},[a("textComponent",{attrs:{text:t.writingText,writing:!(!t.writing&&!t.writingText)}})],1)],1):t._e()],2)],1):t._e(),a("v-uni-view",{staticClass:"box-input",style:"bottom: "+(t.inputShow?"0":"-204rpx")+";"},[a("v-uni-view",{staticClass:"tools"},[t._l(t.langs,(function(e,i){return a("v-uni-view",{staticClass:"item",class:{active:e===t.lang},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.changeLang(e)}}},[a("v-uni-text",[t._v(t._s(e))]),a("v-uni-image",{staticClass:"ic_sj",attrs:{src:"/static/images/write/ic_sj.png"}})],1)})),a("v-uni-view",{staticClass:"item close",style:"transform: rotate("+(t.inputShow?"180":0)+"deg);",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showInput.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"32rpx",height:"32rpx"},attrs:{src:"/static/images/write/ic_up.png"}})],1)],2),a("v-uni-view",{staticClass:"input"},[a("v-uni-textarea",{attrs:{type:"text",fixed:!0,contenteditable:!0,"auto-height":!0,placeholder:t.prompt.hint,maxlength:"3000","cursor-spacing":"0"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),a("v-uni-button",{staticClass:"btn-send",attrs:{type:"submit"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendText.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:"/static/images/ic_send.png"}})],1)],1)],1)],1):t._e()],1)},n=[]},"4a42":function(t,e,a){"use strict";a.r(e);var i=a("f26c"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},"54fd":function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,"uni-page-body[data-v-1d488711]{background:#f3f6f9}body.?%PAGE?%[data-v-1d488711]{background:#f3f6f9}.box-input[data-v-1d488711]{width:100%;height:auto;padding:0 %?30?%;border-top:1px solid #d8d8e2;background:#f4fcfb;box-sizing:border-box;position:absolute;left:0;bottom:0;z-index:2;transition:all .3s}.box-input .tools[data-v-1d488711]{width:100%;height:%?72?%;margin-bottom:%?10?%;box-sizing:border-box;margin-top:%?30?%}.box-input .tools .item[data-v-1d488711]{width:auto;height:%?56?%;line-height:%?56?%;background:#fff;font-size:%?24?%;border-radius:%?10?%;border:1px solid #ddd;color:#444;float:left;margin-right:%?20?%;position:relative;overflow:visible;padding:0 %?20?%}.box-input .tools .item .ic_sj[data-v-1d488711]{width:%?24?%;height:%?12?%;position:absolute;left:50%;margin-left:%?-12?%;bottom:%?-12?%;display:none}.box-input .tools .item.active[data-v-1d488711]{border-color:#04babe}.box-input .tools .item.active .ic_sj[data-v-1d488711]{display:block}.box-input .tools .item[data-v-1d488711]:active{background-color:#fafafa}.box-input .tools .close[data-v-1d488711]{float:right;margin-right:0;background:none;border:none;-webkit-transform:rotate(180deg);transform:rotate(180deg);display:flex;align-items:center;justify-content:center;transition:all .5s}.box-input .input[data-v-1d488711]{width:100%;position:relative;box-sizing:border-box;background:#fff;border:1px solid #ddd;border-radius:%?10?%;overflow:hidden;transition:all 1s;margin-bottom:%?40?%}.box-input .input uni-textarea[data-v-1d488711]{width:100%;height:%?240?%;min-height:%?120?%;max-height:%?600?%;padding:%?20?% %?10?% %?20?% %?20?%;border-radius:%?10?%;line-height:%?40?%;box-sizing:border-box;outline:none;border:none;resize:none;overflow:auto}.box-input .input .btn-send[data-v-1d488711]{position:absolute;right:0;bottom:0;width:%?100?%;height:%?80?%;padding:0;border:none;border-radius:%?10?%;background:none;display:flex;align-items:center;justify-content:center;z-index:9}.box-input .input .btn-send[data-v-1d488711]::after{display:none}.box-input .input .btn-send[data-v-1d488711]:active{background:#f2f2f2}.box-input .input .btn-send uni-image[data-v-1d488711]{width:%?40?%;height:%?40?%}.page[data-v-1d488711]{width:100%;overflow:hidden;display:flex;flex-direction:column;position:absolute;left:0;right:0;top:0;bottom:0;background:#fff}.box-msg-list[data-v-1d488711]{width:100%;box-sizing:border-box;overflow:hidden;overflow-y:scroll;position:absolute;left:0;right:0;top:0;bottom:316px;background:#fff;z-index:1;transition:all .3s}.list[data-v-1d488711]{width:100%;height:auto}.message[data-v-1d488711]{display:flex;justify-content:flex-start;padding:%?40?% %?40?%;border-bottom:%?2?% solid #ddd}.message[data-v-1d488711]:last-child{border-bottom:0}.message .text[data-v-1d488711]{width:100%;color:#343541;line-height:%?52?%;font-size:%?32?%;word-break:break-all;padding:%?3?% 0;overflow:hidden}.message .text span[data-v-1d488711]{display:inline}.message .avatar[data-v-1d488711]{width:%?48?%;height:%?48?%;background:#10a37f;margin-right:%?30?%;color:#fff;font-size:%?28?%;border-radius:%?4?%;display:flex;align-items:center;justify-content:center;margin-top:%?6?%}.message .avatar uni-image[data-v-1d488711],\n.message .avatar img[data-v-1d488711]{width:%?36?%;height:%?36?%}.account[data-v-1d488711]{margin:%?20?% %?30?%;padding:%?16?% %?24?% %?16?% %?24?%;box-sizing:border-box;\n\t/* background: #f3f6f9; */border-radius:%?10?%;display:flex;justify-content:space-between;align-items:center}.account .balance[data-v-1d488711]{color:#666;font-size:%?24?%}.account .balance uni-text[data-v-1d488711]{color:#10a37f;margin-right:%?6?%}.account .btn-pay[data-v-1d488711]{display:inline-block;color:#10a37f;margin-left:%?20?%;font-size:%?24?%}.banner-ad[data-v-1d488711]{width:100%;height:%?120?%;border-top:%?2?% solid #ddd}.cursor[data-v-1d488711]{background:#3d3d3d;width:100%;line-height:100%;border-left:.1em solid transparent;-webkit-animation:cursor-data-v-1d488711 .6s infinite;animation:cursor-data-v-1d488711 .6s infinite;display:inline-block;width:%?10?%;height:%?40?%;position:relative;top:%?6?%}\n\n/* Animation */@-webkit-keyframes cursor-data-v-1d488711{50%{background:#fff}}@keyframes cursor-data-v-1d488711{50%{background:#fff}}.content[data-v-1d488711]{padding:%?20?%}.content uni-view[data-v-1d488711]{margin:%?10?% 0;word-break:break-all;line-height:1.5;font-size:%?28?%;color:#444}.content img[data-v-1d488711]{width:100%}.btn-copy[data-v-1d488711]{color:#409eff}",""]),t.exports=e},"5b81":function(t,e,a){"use strict";var i=a("23e7"),n=a("c65b"),o=a("e330"),s=a("1d80"),r=a("1626"),d=a("7234"),l=a("44e7"),c=a("577e"),u=a("dc4a"),g=a("90d8"),p=a("0cb2"),f=a("b622"),b=a("c430"),h=f("replace"),m=TypeError,v=o("".indexOf),x=o("".replace),w=o("".slice),y=Math.max,k=function(t,e,a){return a>t.length?-1:""===e?a:v(t,e,a)};i({target:"String",proto:!0},{replaceAll:function(t,e){var a,i,o,f,T,_,C,S,D,z=s(this),j=0,I=0,O="";if(!d(t)){if(a=l(t),a&&(i=c(s(g(t))),!~v(i,"g")))throw m("`.replaceAll` does not allow non-global regexes");if(o=u(t,h),o)return n(o,t,z,e);if(b&&a)return x(c(z),t,e)}f=c(z),T=c(t),_=r(e),_||(e=c(e)),C=T.length,S=y(1,C),j=k(f,T,0);while(-1!==j)D=_?c(e(T,j,f)):p(T,f,j,[],void 0,e),O+=w(f,I,j)+D,I=j+C,j=k(f,T,j+S);return I<f.length&&(O+=w(f,I)),O}})},"8f61":function(t,e,a){"use strict";a.r(e);var i=a("1e4d"),n=a("4a42");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("a9ab");var s=a("f0c5"),r=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"1d488711",null,!1,i["a"],void 0);e["default"]=r.exports},a9ab:function(t,e,a){"use strict";var i=a("056a"),n=a.n(i);n.a},f26c:function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("ade3")),o=i(a("c7eb")),s=i(a("1da1"));a("ac1f"),a("5319"),a("498a"),a("14d9"),a("d3b7"),a("e9c4"),a("8a79"),a("c975"),a("e25e"),a("5b81");var r,d=i(a("44fb"));a("fd1e8"),a("279a"),a("a7eb"),a("40d3");var l=getApp(),c=[],u=0,g={components:{TextComponent:d.default},data:function(){return{pageIsLoad:!1,siteroot:"",lists:[],message:"",writingText:"",writing:!1,page:1,pagesize:10,scrollTop:0,prompt:{},lang:"简体中文",langs:["简体中文","繁体中文","English"],inputShow:!0}},onLoad:function(t){this.onLoadClone(t)},methods:(r={onLoadClone:function(t){var e=this;t.sid&&uni.setStorageSync("sid",t.sid),t.prompt_id&&this.setData({prompt_id:t.prompt_id}),this.setData({system:l.globalData.system,siteroot:l.globalData.siteroot.replace("/web.php","")}),l.globalData.util.checkLogin().then((function(){e.getPrompt(),e.getHistoryMsg(),e.setData({pageIsLoad:!0})}))},sendText:function(){var t=this;return(0,s.default)((0,o.default)().mark((function e(){var a,i,n,s,r,d,g,p,f,b,h,m,v,x,w;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.writing){e.next=2;break}return e.abrupt("return");case 2:if(a=t.trim(t.message),a){e.next=12;break}if(!t.prompt.hint){e.next=9;break}t.message=t.prompt.hint,a=t.message,e.next=12;break;case 9:return l.globalData.util.message("请输入你的问题"),t.message="",e.abrupt("return");case 12:return u&&(clearInterval(u),u=0,c=[]),t.lists.push({user:"我",message:a}),t.message="",t.writing=!0,t.scrollToBottom(),i=new Headers,i.append("Content-Type","application/json"),i.append("X-site",uni.getStorageSync("sitecode")),n=t.siteroot+"/web.php/chat/sendText",s={prompt_id:t.prompt_id,message:a},e.next=24,fetch(n,{method:"POST",headers:i,body:JSON.stringify(s)});case 24:if(r=e.sent,r.ok){e.next=29;break}return t.writing=!1,l.globalData.util.message(r.statusText),e.abrupt("return");case 29:d=r.body.getReader(),g=new TextDecoder("utf-8"),p=!1,f="",u=setInterval((function(){c.length>0?(t.writingText+=c.shift(),t.scrollBottom()):t.writing||(clearInterval(u),u=0,t.writingText&&t.lists.push({user:"AI",message:t.writingText}),t.writingText="",setTimeout((function(){t.scrollToBottom()}),500))}),50);case 34:if(p){e.next=55;break}return t.scrollToBottom(),e.next=38,d.read();case 38:if(b=e.sent,h=b.value,m=b.done,!h){e.next=52;break}if(v=g.decode(h),"\n"!==v||!f.endsWith("\n")){e.next=45;break}return e.abrupt("continue",34);case 45:if(!v){e.next=52;break}if(-1===v.indexOf("[error]")){e.next=50;break}if(x=function(){t.writing=!1,t.writingText="",t.lists.pop();var e=v.replace("[error]","");return-1!==e.indexOf("请登录")?(t.$emit("showlogin"),setTimeout((function(){l.globalData.util.message(e)}),500)):-1!==e.indexOf("请充值")?(t.$emit("showUserInfo"),setTimeout((function(){l.globalData.util.message(e)}),500)):l.globalData.util.message(e,"error"),"break"}(),"break"!==x){e.next=50;break}return e.abrupt("break",55);case 50:for(t.writing=!0,w=0;w<v.length;w++)c.push(v[w]);case 52:p=m,e.next=34;break;case 55:t.writing=!1;case 56:case"end":return e.stop()}}),e)})))()},showInput:function(){var t=this;this.inputShow=!this.inputShow,setTimeout((function(){t.scrollBottom()}),300)},changeLang:function(t){this.lang=t,l.globalData.util.message("已切换为【"+t+"】输出"),this.inputShow=!0},getHistoryMsg:function(){var t=this;l.globalData.util.request({url:"/write/getHistoryMsg",data:{prompt_id:this.prompt_id,page:this.page,pagesize:this.pagesize}}).then((function(e){e.data.length>0&&t.setData({lists:e.data}),setTimeout((function(){t.scrollToBottom()}),500)}))},getPrompt:function(){var t=this;l.globalData.util.request({url:"/write/getPrompt",data:{prompt_id:this.prompt_id}}).then((function(e){t.setData({prompt:e.data}),document.title=e.data.title}))},scrollToBottom:function(){var t=this;setTimeout((function(){var e=uni.createSelectorQuery().in(t);e.select(".list").boundingClientRect((function(e){t.setData({scrollTop:parseInt(e.height)})})),e.exec((function(t){}))}),100)},copyText:function(t){var e=t.currentTarget.dataset.index,a=this.lists,i=a[e].message;i=i.join("\n"),i=i.replaceAll("&nbsp;"," "),uni.setClipboardData({data:i})},getShareId:function(t){var e=this;return(0,s.default)((0,o.default)().mark((function a(){var i;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=0,a.next=3,l.globalData.util.request({url:"/wxapp/doShare",data:{way:t}}).then((function(a){i=a.data.share_id,"timeline"==t&&e.setData({timeline_share_id:i})}));case 3:return a.abrupt("return",i);case 4:case"end":return a.stop()}}),a)})))()}},(0,n.default)(r,"copyText",(function(t){var e=document.createElement("textarea");e.value=t,e.readOnly="readOnly",e.style="width:0;height:0;",document.body.appendChild(e),e.select(),e.setSelectionRange(0,t.length),l.globalData.util.message("已复制"),document.execCommand("copy"),e.remove()})),(0,n.default)(r,"trim",(function(t){return t?t.replace(/(^\s*)|(\s*$)/g,""):""})),r)};e.default=g}}]);